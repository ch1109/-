# 角色数据流转关系图实现说明

## 一、功能概述

根据 `角色-数据关系.prd` 文档的要求，成功实现了一个交互式的"角色数据流转关系图"页面，用于可视化展示AI理财投顾平台中9个专业AI角色之间的数据流转关系和协作机制。

## 二、实现的功能

### 1. 核心可视化功能
- ✅ **9个AI角色节点展示**：包括调度协调管家、财富规划师、投资策略师、风控合规官、投资顾问、客户理财顾问、财富管家、数据分析师、市场研究员
- ✅ **外部数据源节点**：银行数据源、用户输入、证券数据源
- ✅ **分层架构展示**：
  - 外部数据源层（灰色）
  - 接口层（蓝色）
  - 决策层（紫色）
  - 执行层（绿色）
  - 支持层（橙色）

### 2. 数据流转可视化
- ✅ **四种数据流类型**：
  - 银行数据流（蓝色虚线）
  - 证券数据流（绿色虚线）
  - Agent间数据流（黑色实线）
  - 用户交互（橙色实线）
- ✅ **箭头指向**：清晰展示数据流动方向
- ✅ **贝塞尔曲线连接**：使用平滑曲线连接节点，视觉效果更佳

### 3. 场景切换功能
实现了4个典型场景的可视化：
- ✅ **全局视图**：显示所有角色和数据流转关系
- ✅ **新用户首次购买**：涉及所有9个角色的完整流程
- ✅ **老客户快速服务**：只涉及4个角色的快速路径
- ✅ **市场危机应对**：30分钟应急响应，4个Agent并行工作
- ✅ **策略动态调整**：再平衡闭环流程

场景切换时，未涉及的节点和连接线会变为半透明，高亮显示相关节点和数据流。

### 4. 交互功能
- ✅ **点击节点查看详情**：
  - 显示角色的emoji图标和名称
  - 展示输入来源列表
  - 展示核心处理步骤
  - 展示输出目标列表
- ✅ **悬停数据流显示标签**：鼠标悬停在连接线上时显示数据类型
- ✅ **节点选中状态**：选中的节点显示黄色边框
- ✅ **详情面板**：右侧固定详情面板，显示选中角色的完整信息

### 5. 视觉设计
- ✅ **配色方案**：按照PRD要求使用不同颜色区分层级
- ✅ **图例说明**：顶部工具栏显示数据流类型图例
- ✅ **响应式设计**：支持不同屏幕尺寸
- ✅ **动画效果**：节点悬停放大、详情面板淡入淡出

## 三、技术实现

### 1. 文件结构
```
roadmap-web/src/
├── components/
│   ├── RoleDataFlow.tsx      # 主组件
│   └── RoleDataFlow.css      # 样式文件
├── data/
│   ├── roleDataFlow.ts       # 数据定义
│   └── index.ts              # 数据导出
└── App.tsx                   # 集成到主应用
```

### 2. 数据结构
**roleDataFlow.ts** 定义了：
- `RoleNode` 接口：角色节点的数据结构
- `DataFlow` 接口：数据流转的数据结构
- `roleNodes` 数组：9个AI角色的完整信息
- `externalNodes` 数组：3个外部数据源
- `dataFlows` 数组：所有数据流转关系
- `scenarios` 数组：4个典型场景定义

### 3. 组件实现
**RoleDataFlow.tsx** 实现了：
- SVG绘制节点和连接线
- 场景切换逻辑
- 节点选中和详情展示
- 悬停交互效果
- 箭头标记定义

### 4. 样式设计
**RoleDataFlow.css** 实现了：
- 工具栏布局
- 画布和详情面板布局
- 节点和连接线的交互效果
- 响应式设计
- 动画效果

## 四、使用方法

### 1. 访问页面
1. 启动开发服务器：`npm run dev`
2. 在浏览器中打开应用
3. 点击顶部导航栏的"角色数据流转关系图"

### 2. 操作说明
1. **切换场景**：使用顶部的场景选择下拉菜单
2. **查看角色详情**：点击任意角色节点
3. **查看数据流**：鼠标悬停在连接线上
4. **关闭详情面板**：点击详情面板右上角的 ✕ 按钮

## 五、数据来源

所有角色信息和数据流转关系均来自 `角色-数据关系.prd` 文档，包括：
- 9个角色的输入来源、核心处理、输出目标
- 银行端和证券端的数据类型
- 4个典型场景的流程说明

## 六、优化和改进

### 已完成的优化
1. ✅ 调整SVG viewBox，确保顶部节点完整显示
2. ✅ 优化节点位置，避免重叠
3. ✅ 调整画布内边距，确保内容不被裁剪
4. ✅ 使用贝塞尔曲线使连接线更平滑

### 未来可扩展功能
- 🔄 添加搜索功能，快速定位角色
- 🔄 支持拖拽调整节点位置
- 🔄 导出为图片功能
- 🔄 添加更多场景示例
- 🔄 支持缩放和平移画布

## 七、技术栈

- **React 19.1.1**：UI框架
- **TypeScript**：类型安全
- **SVG**：矢量图形绘制
- **CSS3**：样式和动画
- **Vite**：构建工具

## 八、浏览器兼容性

支持所有现代浏览器：
- Chrome/Edge 90+
- Firefox 88+
- Safari 14+

## 九、总结

成功实现了一个功能完整、交互友好的角色数据流转关系图，完全符合PRD文档的要求。该可视化工具能够帮助：
- 开发团队理解系统架构
- 业务人员了解数据流转逻辑
- 作为产品文档的可视化补充

所有功能均已测试通过，可以正常使用。

