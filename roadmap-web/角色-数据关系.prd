# Cursor 开发所需的完整上下文信息

## 一、项目背景

**项目名称：** AI理财投顾平台数据流转可视化网页

**核心目标：** 创建一个交互式可视化页面，展示9个专业AI角色之间的数据流转关系，帮助理解整个平台的数据流向和角色协作机制。

**主要用途：** 
- 让开发团队理解系统架构
- 向业务人员展示数据流转逻辑
- 作为产品文档的可视化补充

---

## 二、系统架构说明

### 整体架构分层

**4个层级（从上到下）：**

1. **外部数据源层**
   - 🏦 银行数据源
   - 👤 用户输入
   - 📈 证券数据源

2. **接口层（蓝色）**
   - 🎯 调度协调管家

3. **决策层（浅蓝色背景框包裹）**
   - 💼 财富规划师
   - 📊 投资策略师
   - 🛡️ 风控合规官

4. **执行层（浅灰色背景框包裹）**
   - 📈 投资顾问
   - 🧠 客户理财顾问
   - 🏦 财富管家

5. **支持层（橙色）**
   - 📊 数据分析师（核心数据枢纽）
   - 🔍 市场研究员

### 数据流向规则

**三种数据流类型：**
- **银行数据流**：蓝色虚线，从银行数据源流向数据分析师
- **证券数据流**：绿色虚线，从证券数据源流向数据分析师
- **Agent间数据流**：黑色实线，各角色之间的数据传递

**核心数据枢纽：**
数据分析师是整个系统的数据中心，负责整合银行端和证券端的原始数据，构建统一的用户画像，并分发给所有其他角色使用。

---

## 三、9个角色的完整信息

### 1. 🎯 调度协调管家 (Orchestrator)

**层级：** 接口层

**输入来源：**
- 👤 用户：文字/语音输入、点击行为、页面停留时间
- 🤖 所有8个Agent：各角色处理完成后的结果

**核心处理：**
1. NLU识别50+种场景意图
2. 将复杂任务拆解为子任务
3. 选择合适Agent进行调用
4. 整合多Agent输出为自然对话
5. 维护对话上下文

**输出目标：**
- 👤 用户：整合后的自然语言回复
- 🤖 各专业Agent：分派具体任务指令

---

### 2. 💼 财富规划师 (Wealth Planner)

**层级：** 决策层

**输入来源：**
- 🎯 调度协调管家：需求挖掘/目标设定/危机应对任务
- 📊 数据分析师：用户画像（年龄/职业/收入/资产）、历史目标、行为特征
- 🏦 财富管家：投资表现数据、财务危机信号
- 🏦 银行端（通过数据分析师）：
  * 个人基础信息（姓名/年龄/婚姻/职业/城市）
  * 收入数据（工资流水/奖金/月收入/稳定性）
  * 支出数据（日常消费/房贷车贷/信用卡还款）
  * 存款数据（活期/定期余额/到期日）
  * 负债数据（房贷/车贷/消费贷）
  * 理财产品持仓（产品/金额/净值）
  * 大额交易记录（转账/金额/时间）
- 📈 证券端（通过数据分析师）：
  * 股票持仓（代码/市值/盈亏）- 识别真实风险偏好
  * 基金持仓（份额/市值/收益率）
  * 证券账户现金余额
  * 融资融券信息

**核心处理：**
1. 设计3-5轮开放式提问挖掘真实需求
2. 识别缺失信息定向追问
3. 将模糊目标转化为SMART目标
4. 评估目标可行性
5. 协调多目标优先级和资金分配
6. 生成财富健康7维度评分

**输出目标：**
- 📊 投资策略师：标准化目标包（目标金额/期限/风险承受度/月投金额/流动性要求/约束条件）
- 🎯 调度协调管家：引导式提问内容、目标确认对话
- 📊 数据分析师：画像更新请求
- 🧠 客户理财顾问：危机应对方案（特定场景）

---

### 3. 📊 投资策略师 (Investment Strategist)

**层级：** 决策层

**输入来源：**
- 💼 财富规划师：标准化目标包
- 🔍 市场研究员：市场环境分析（牛熊震荡）、估值水平、宏观数据、行业投资价值
- 📊 数据分析师：用户当前持仓、风险承受能力评分、投资行为特征
- 🏦 财富管家：持仓偏离度数据、再平衡触发信号
- 🏦 银行端（通过数据分析师）：
  * 总资产规模（存款+理财）
  * 风险测评结果（保守/稳健/进取）
  * 理财产品持仓
- 📈 证券端（通过数据分析师）：
  * 股票和基金持仓（市值/占比）
  * 行业分布和集中度
  * 历史交易记录（定投/择时）
  * 持有周期（长期/短期）

**核心处理：**
1. 制定战略资产配置SAA（长期比例）
2. 根据市场环境战术调整TAA
3. 生成保守/稳健/进取三种方案
4. 运行10000次蒙特卡洛模拟
5. 用历史10-20年数据回测验证
6. 判断再平衡时机和幅度

**输出目标：**
- 📈 投资顾问：配置需求（资产配置比例/产品类型要求/筛选标准/预期收益/成功概率）
- 🛡️ 风控合规官：风险审核请求（三方案配置/压力测试数据）
- 🎯 调度协调管家：方案展示数据（雷达图/模拟曲线/回测图表）
- 🏦 财富管家：再平衡执行指令
- 🧠 客户理财顾问：市场危机应对策略

---

### 4. 🛡️ 风控合规官 (Risk & Compliance Officer)

**层级：** 决策层

**输入来源：**
- 📊 投资策略师：风险审核请求（三方案配置/模拟结果）
- 📊 数据分析师：风险承受能力评分、风险测评结果、年龄、历史风险行为
- 🔍 市场研究员：当前市场风险等级、系统性风险信号、产品风险评级
- 📈 投资顾问：待审核产品列表及风险指标
- 🏦 银行端（通过数据分析师）：
  * 风险测评结果（问卷/等级R1-R5）
  * 理财产品持仓（风险等级）
  * 理财底层资产（投资方向/股债比例）
  * 负债数据（评估负债率）
  * 产品流动性（赎回规则/封闭期）
- 📈 证券端（通过数据分析师）：
  * 股票持仓（计算市场风险和回撤）
  * 行业和个股集中度
  * 融资融券信息（余额/倍数/强平线距离）
  * 期权/衍生品持仓
  * 历史交易记录（追涨杀跌行为）
  * 波动率、最大回撤、夏普比率

**核心处理：**
1. 计算产品风险与用户承受能力的匹配度
2. 进行2008/2015/2020极端情景压力测试
3. 检查流动性是否满足目标期限
4. 执行合规性检查（双录等）
5. 监控黄/橙/红三级预警阈值
6. 决策是否需要强制干预熔断

**输出目标：**
- 📈 投资顾问：审核结果（方案通过状态/匹配评分/风险提示/合规要求）
- 🧠 客户理财顾问：风险揭示话术（最坏情况/历史数据/需确认风险点）
- 🎯 调度协调管家：风险预警消息（预警级别/触发原因/影响用户）
- 🏦 财富管家：强制干预指令（极端情况止损）
- 📊 数据分析师：合规记录存档请求

---

### 5. 📈 投资顾问 (Investment Advisor)

**层级：** 执行层

**输入来源：**
- 📊 投资策略师：配置需求（产品类型/配置比例/筛选标准）
- 🛡️ 风控合规官：审核结果（方案通过/风险提示/合规要求）
- 🔍 市场研究员：产品评级数据库、基金经理履历、产品研报、产品异常信号
- 📊 数据分析师：用户已有持仓、历史购买偏好、申购赎回记录
- 👤 用户：查看产品详情、确认购买操作
- 🏦 银行端（通过数据分析师）：
  * 可投资金额（活期余额-应急储备）
  * 投资期限要求
  * 理财产品持仓（避免重复配置）
  * 银行客户等级（VIP/私行/普通）
  * 购买记录（时间/产品类型/金额）
  * 赎回历史（持有期限）
  * 产品费用明细（申购/赎回/管理费）
- 📈 证券端（通过数据分析师）：
  * 基金持仓明细（十大重仓股/行业分布）- 穿透式分析
  * 基金经理信息（任期/历史收益/变动）
  * 基金规模变化（趋势/异常增长）
  * 基金同类排名（相对收益/跑输跑赢）
  * 交易记录和交易成本
  * 历史收益率

**核心处理：**
1. 从1000+产品海选50个符合条件的
2. 通过七维度评分初选15个
3. 深度研究（底层持仓/经理风格/费率）精选5个
4. 生成横向对比表
5. 执行利他检查（三不推、三必须原则）
6. 执行实际申购赎回交易

**输出目标：**
- 🧠 客户理财顾问：产品推荐报告（5个精选产品/对比表/不推荐理由/最坏情况）
- 🎯 调度协调管家：产品展示UI数据
- 🏦 财富管家：交易执行结果（交易ID/购买产品/定投设置）
- 📊 数据分析师：交易记录（更新持仓）
- 👤 用户：案例展示内容、问答墙

---

### 6. 🧠 客户理财顾问 (Client Advisor)

**层级：** 执行层

**输入来源：**
- 📈 投资顾问：产品推荐报告（5个精选产品/对比表/利他信息）
- 📊 数据分析师：用户行为数据（页面停留/鼠标轨迹/查看频率）、情绪状态（焦虑/恐慌等）、认知偏差（损失厌恶/锚定效应）、历史疑虑记录
- 🛡️ 风控合规官：风险揭示文案（需说明风险点/最坏情况）
- 📊 投资策略师：市场危机应对策略（坚持/调整/暂停）
- 🔍 市场研究员：市场危机分析（原因/历史对比/恢复时间）
- 🏦 财富管家：持仓数据（浮盈浮亏/查看频率异常）
- 🏦 银行端（通过数据分析师）：
  * 购买记录（识别决策偏好）
  * 购买犹豫时长（页面停留/决策周期）
  * 市场波动时的行为（查看频率/操作）
  * 对话历史和咨询记录
- 📈 证券端（通过数据分析师）：
  * 交易频率（月度交易次数）- 识别冲动交易
  * 追涨杀跌记录（高点买入/低点卖出）
  * 持有时长（平均持有天数）- 判断耐心度
  * 交易时机选择

**核心处理：**
1. 基于用户画像和行为智能预判6个最可能的疑虑
2. 设计坦诚建立信任的利他话术
3. 识别12种投资认知偏差温和干预
4. 识别6种情绪状态生成对应安抚话术
5. 判断购买时机（准备好/犹豫/冲动）
6. 设计成交策略（阶梯式入场/7天冷静期）

**输出目标：**
- 🎯 调度协调管家：销售对话脚本（预判疑虑/主动披露佣金/产品缺陷）
- 🎯 调度协调管家：临门成交话术（识别犹豫类型/阶梯式入场方案）
- 🎯 调度协调管家：72小时陪伴话术（T+6h/24h/48h触达/异常干预）
- 🎯 调度协调管家：危机安抚话术（情绪共情/数据支撑/三种选择）
- 📊 数据分析师：用户情绪状态反馈（对话后情绪变化/干预效果）

---

### 7. 🏦 财富管家 (Wealth Manager)

**层级：** 执行层

**输入来源：**
- 📊 数据分析师：持仓数据（实时持仓/成本/市值）、收益数据（浮盈浮亏/收益率）、账户余额（闲置资金）、行为数据（查看频率）、目标数据（完成进度）
- 📊 投资策略师：再平衡指令（偏离原因/调整方案）
- 🔍 市场研究员：产品评级变化、产品异常事件（经理变更/规模异动）、持仓匹配行业分析
- 📈 投资顾问：交易执行结果（购买产品/金额/定投设置）
- 🛡️ 风控合规官：强制干预指令（极端情况止损）
- 🏦 银行端（通过数据分析师）：
  * 理财产品持仓（名称/份额/净值/市值）
  * 理财产品净值历史
  * 产品费用明细（申购/赎回/管理费）
  * 分红记录（金额/时间/分红率）
  * 活期和定期存款余额
  * 定期存款到期日
- 📈 证券端（通过数据分析师）：
  * 基金持仓明细（十大重仓股/行业分布）
  * 基金经理信息（任期/变动记录）
  * 基金规模变化（趋势/异常）
  * 基金同类排名（相对收益）
  * 股票和基金总市值
  * 配股/权益事件
  * 交易成本（佣金/年度总成本）

**核心处理：**
每日：扫描闲置资金、监控持仓异常、检查再平衡阈值、检测行为异常
每周：评估持仓健康度七维度评分、生成智能提醒
每月：生成月度报告6大板块、扫描费率优化机会
每季度：评估再平衡和产品替换

**输出目标：**
- 🎯 调度协调管家：智能提醒消息（定投日/目标进度/异常预警）
- 🎯 调度协调管家：月度财富健康报告（业绩/目标进度/7维度评分/行为评价/下月建议）
- 🎯 调度协调管家：老客户快速服务界面（资产概览/智能提醒/快捷操作）
- 📊 投资策略师：再平衡触发信号（当前配置/目标配置/偏离度）
- 🧠 客户理财顾问：异常行为信号（频繁查看/情绪预测）
- 💼 财富规划师：投资表现数据、财务危机信号
- 📊 数据分析师：持仓变更记录

---

### 8. 📊 数据分析师 (Data Analyst)

**层级：** 支持层（核心数据枢纽）

**输入来源：**
- 🎯 调度协调管家：用户对话内容（每轮完整记录）
- 📈 投资顾问：交易记录（申购赎回/产品/金额/时间）
- 🏦 财富管家：持仓变更记录（再平衡结果/费率优化操作）
- 系统自动采集：用户行为日志（登录时间/页面浏览/点击/查看频次）
- 🛡️ 风控合规官：风险测评结果（答案/评分/双录元数据）
- 💼 财富规划师：目标设定数据（用户目标/调整记录）
- 🏦 银行端（核心数据整合源）：
  * 个人基础信息（姓名/年龄/婚姻/职业/城市）
  * 收支数据（工资流水/奖金/月收入/月支出）
  * 资产数据（活期/定期存款/理财持仓/保险）
  * 负债数据（房贷/车贷/消费贷/信用卡）
  * 交易数据（大额转账/购买赎回记录）
  * 风险测评（问卷/风险等级/测评日期）
  * 客户等级（VIP等级/金融资产规模）
- 📈 证券端（核心数据整合源）：
  * 账户信息（账户号/开户日期/可用资金）
  * 股票持仓（代码/数量/成本/市值/行业分布）
  * 基金持仓（代码/份额/成本/市值/持仓明细）
  * 交易记录（时间/品种/买卖方向/价格/费用）
  * 融资融券（余额/倍数/强平线距离）
  * 衍生品（期权持仓/做空头寸）
  * 行为数据（交易频率/追涨杀跌/持有时长）

**核心处理：**
1. 实时分析对话提取关键信息
2. 更新120+标签画像
3. 识别行为特征（决策风格/情绪/偏差）
4. 异常检测（查看频率/风险偏好突变）
5. 每日计算持仓数据、目标进度、流失风险
6. 每周/月洞察用户行为模式
7. **最重要：整合银行和证券数据为统一用户画像**

**输出目标：**
- 🤖 所有Agent：用户画像数据（基本信息/财务状况/风险画像/投资目标/行为特征/120+标签）
- 🤖 所有Agent：持仓数据（总资产=银行+证券/各持仓明细/当前配置/偏离度）
- 🤖 所有Agent：行为异常信号（类型/频率/情绪预测）
- 🤖 所有Agent：用户情绪状态（当前情绪/置信度/判断依据）
- 🤖 所有Agent：流失风险预测（30天90天概率/风险因素）
- 🎯 调度协调管家：每周产品转化率分析、每月用户行为洞察

**数据整合的核心价值：**
- 完整资产视图：总资产=银行存款+银行理财+证券现金+证券股票基金
- 真实风险识别：对比银行风险测评（问卷保守）与证券实际操作（高频交易+高杠杆）
- 行为模式综合：银行购买犹豫+证券追涨杀跌，综合识别认知偏差
- 配置结构穿透：银行理财底层+证券基金持仓，发现伪分散问题
- 财务健康全貌：银行负债率+证券杠杆率，全面评估债务压力

---

### 9. 🔍 市场研究员 (Market Researcher)

**层级：** 支持层

**输入来源：**
- 外部13大信息源（7×24小时自动采集）：
  * 财经新闻（新浪财经/东方财富/财联社）
  * 券商研报、基金公司研报
  * 监管公告（证监会/交易所）
  * 政策文件（央行政策/财政政策）
  * 宏观数据（GDP/CPI/PMI/社融）
  * 行业动态（行业协会/产业报告）
  * 社交媒体情绪（雪球/股吧）
  * 基金公告、定期报告
  * 产品评级（晨星/银河评级）
  * 持仓数据（基金季报）
  * 业绩数据（基金净值/收益率）
  * 估值数据（PE/PB/股息率）
  * 技术指标
- 📊 投资策略师：研究需求（如行业投资价值分析，24小时内完成）
- 📈 投资顾问：产品研究需求（如基金经理变更影响分析）

**核心处理：**
1. 7×24小时实时采集13大信息源
2. 信息过滤去重去噪
3. 按关键词和来源权威性排序
4. 识别系统性/行业/个股风险信号
5. 触发阈值立即预警
6. 每日凌晨生成200字市场简报
7. 每周轮动深度研究13个行业
8. 每月推送10个投资机会
9. 突发事件1小时内分析影响

**输出目标：**
- 📊 投资策略师：每日市场简报（主动推送，隔夜市场/今日预测/关键事件）
- 📊 投资策略师：市场环境分析（被动响应，市场阶段/估值水平/风险级别）
- 📈 投资顾问：产品评级数据库（主动推送异常如经理变更/影响分析）
- 📈 投资顾问：产品深度研报（被动响应，经理档案/业绩分析/费率结构）
- 🛡️ 风控合规官：风险信号预警（主动推送，预警级别/风险类型/影响范围）
- 🏦 财富管家：持仓匹配行业分析（主动推送，用户持仓对应行业/行业更新）
- 🧠 客户理财顾问：危机分析报告（触发事件/原因分析/恢复时间预测）

---

## 四、4个典型场景说明

### 场景1：新用户首次购买（最长流程，7步）

**涉及的节点和数据流：**
1. **接待识别**：用户 → 调度协调管家 ← 数据分析师（查询银行证券记录判断新用户）
2. **需求挖掘**：调度协调管家 → 财富规划师 ← 数据分析师（银行收入3.5万/月支出2万/存款10万/房贷1.2万 + 证券持仓0元）→ 输出标准化目标包（学区房首付30万/12个月/月投2.5万）
3. **方案设计**：财富规划师 → 投资策略师 ← 市场研究员（市场环境）→ 生成三方案 → 风控合规官（审核）→ 投资顾问（筛选产品）
4. **疑虑解答**：投资顾问 → 客户理财顾问（智能预判6个疑虑，生成利他话术）
5. **临门犹豫**：检测停留3分15秒 → 客户理财顾问（识别犹豫类型，生成阶梯式入场方案）
6. **合规成交**：风控合规官（双录+风险测评）→ 投资顾问（执行交易）→ 财富管家（设置提醒）→ 数据分析师（更新持仓）
7. **72小时陪伴**：客户理财顾问 → T+6h新手教育、T+24h异常干预、T+48h鼓励坚持

**可视化要点：**
- 这是最长的流程，涉及所有9个角色
- 重点展示银行和证券数据如何在步骤2汇聚到数据分析师
- 重点展示步骤3的多角色并行工作

---

### 场景2：老客户快速服务（最短流程）

**涉及的节点和数据流：**
用户刷卡 → 调度协调管家（识别老客户）→ 财富管家 ← 数据分析师（银行理财15万+证券基金17.8万=总资产32.8万）→ 显示资产概览界面 → 用户点击追加定投 → 投资顾问（执行）

**可视化要点：**
- 只涉及4个角色，最短路径
- 高亮显示"跳过需求挖掘"的快速通道
- 在财富管家节点旁显示"资产概览UI"示意

---

### 场景3：市场危机应对（30分钟应急响应）

**涉及的节点和数据流：**
外部市场（大盘跌-6.2%）→ 风控合规官（评估所有用户证券持仓风险，发布红色预警）→ 同时触发4个Agent并行工作：
- 市场研究员：30分钟输出危机分析报告
- 投资策略师：生成三种应对策略（坚持/调整/暂停）
- 财富管家：识别需安抚的用户（证券持仓>50万且股票占比>60%）
- 数据分析师：提供用户持仓数据（证券持仓亏损金额）

4个Agent输出汇聚 → 客户理财顾问（生成个性化安抚话术）→ 调度协调管家 → 批量推送用户

**可视化要点：**
- 重点展示4个Agent并行工作（用分叉箭头）
- 用红色高亮表示危机状态
- 标注时间节点"5分钟预警 → 30分钟完成"

---

### 场景4：策略动态调整（再平衡闭环）

**涉及的节点和数据流：**
财富管家（检测持仓偏离16%，银行理财10万+证券股票基金22.8万，股票型占76% vs 目标60%）→ 投资策略师（制定调整方案：减少证券股票基金5.2万，增加债券3.3万）→ 风控合规官（审核通过）→ 财富管家（执行调仓：证券端卖出3万，银行/证券端买入债券3.3万）→ 数据分析师（更新持仓）→ 调度协调管家 → 通知用户

**可视化要点：**
- 展示闭环流程（从财富管家开始，回到财富管家）
- 在投资策略师节点显示"股票76%→60%"调整箭头
- 在风控官节点显示"✓审核通过"标记

---

## 五、视觉设计规范

### 布局参考

**按照上传的参考图片风格：**
- 垂直分层布局，清晰直观
- 从上到下：外部数据源 → 接口层 → 决策层+执行层（左右并列）→ 支持层
- 决策层3个角色用浅蓝色背景框包裹
- 执行层3个角色用浅灰色背景框包裹
- 数据分析师居中靠下，因为它是数据枢纽

### 配色方案

**节点颜色（按层级）：**
- 接口层：蓝色 #3B82F6
- 决策层：紫色 #A855F7
- 执行层：绿色 #10B981
- 支持层：橙色 #F59E0B

**节点样式：**
- 背景：白色
- 边框：浅灰色 #E5E7EB
- 圆角：8px
- 内边距：16px

**层级背景框：**
- 决策层框：浅蓝色 #EFF6FF
- 执行层框：浅灰色 #F3F4F6

**连接线颜色：**
- 银行数据流：蓝色虚线 #3B82F6
- 证券数据流：绿色虚线 #10B981
- Agent间数据流：黑色实线 #000000
- 箭头线宽：2px

**交互状态：**
- 悬停节点：显示阴影 shadow-lg、边框加粗
- 选中节点：黄色边框 #FBBF24、边框宽度3px
- 高亮路径：连接线加粗到3px、颜色加深
- 未激活节点：透明度降至0.3

### 字体规范

- 节点内角色名称：16px 加粗
- 连接线上的数据标签：12px 常规
- 详情面板标题：20px 加粗
- 详情面板正文：14px 常规
- 图标emoji：24px

### 间距规范

- 节点之间垂直间距：80px
- 节点之间水平间距：120px
- 层级框内边距：32px
- 详情面板内边距：24px

---

## 六、交互行为说明

### 鼠标悬停

**悬停节点时：**
- 节点轻微放大（scale: 1.05）
- 显示阴影效果（shadow-lg）
- 鼠标指针变为手型（cursor: pointer）
- 所有连接到该节点的箭头高亮（加粗）

**悬停连接线时：**
- 连接线加粗（从2px到3px）
- 显示数据标签气泡（如"标准化目标包"）
- 气泡显示简短数据说明

### 点击交互

**点击节点时：**
- 节点显示选中状态（黄色边框3px）
- 右侧或弹窗显示详情面板，包含：
  * 角色基本信息（emoji + 中文名 + 英文名）
  * 输入来源（分组：银行端/证券端/其他Agent）
  * 核心处理（3-5个步骤）
  * 输出目标（列出目标角色和数据类型）
- 详情面板使用滑入动画（从右侧滑入，300ms）

**点击连接线时：**
- 连接线高亮显示
- 详情面板显示该连接的数据传递信息：
  * 数据来源角色 → 数据接收角色
  * 传递的数据类型和内容说明
  * 数据结构示例（3-5个关键字段）

**点击场景按钮时：**
- 按钮背景色变化（表示选中状态）
- 视图平滑过渡到场景模式
- 涉及的节点保持正常亮度或高亮
- 未涉及的节点和连接线变为半透明（opacity: 0.3）
- 使用淡入淡出动画（500ms）

### 动画效果

**状态变化：**
- 所有状态变化使用平滑过渡（transition: all 300ms ease-in-out）
- 节点放大/缩小使用transform动画
- 透明度变化使用opacity动画

**场景切换：**
- 节点和连接线淡入淡出（fade-in/fade-out）
- 详情面板滑入滑出（slide-in/slide-out）

**搜索高亮：**
- 匹配的节点使用闪烁效果（pulse animation）引起注意
- 闪烁2次后保持高亮状态

---

## 七、详情面板内容结构

### 面板头部
- emoji图标（大号 48x48px）
- 角色中文名（20px 加粗）
- 角色英文名（14px 灰色）
- 关闭按钮 ✕（右上角）

### 面板内容（Tab切换）

**Tab 1: 输入来源**
```
📥 输入来源

🏦 银行端数据
  • 个人基础信息 🔴核心
    说明：用于判断人生阶段
  • 收入数据 🔴核心
    说明：计算可投资金额
  • 支出数据 🔴核心
    说明：评估现金流

📈 证券端数据
  • 股票持仓
    说明：识别真实风险偏好
  • 基金持仓
    说明：了解权益资产占比

🤖 其他Agent
  • 来自调度协调管家
    数据：任务指令
  • 来自数据分析师
    数据：用户画像数据
```

**Tab 2: 核心处理**
```
⚙️ 核心处理

1. 设计3-5轮开放式提问挖掘真实需求
2. 识别缺失信息定向追问
3. 将模糊目标转化为SMART目标
4. 评估目标可行性
5. 协调多目标优先级和资金分配
6. 生成财富健康7维度评分
```

**Tab 3: 输出目标**
```
📤 输出目标

• 投资策略师
  数据类型：标准化目标包
  内容：目标金额/期限/风险承受度/月投金额

• 调度协调管家
  数据类型：引导式提问内容
  内容：目标确认对话

• 数据分析师
  数据类型：画像更新请求
  内容：基于对话更新用户标签
```

---

## 八、顶部工具栏说明

### 场景选择下拉菜单
- 默认选项：全局视图（显示所有连接）
- 选项1：新用户首次购买（7步流程）
- 选项2：老客户快速服务（快速路径）
- 选项3：市场危机应对（30分钟应急）
- 选项4：策略动态调整（再平衡闭环）

### 数据源筛选复选框
- ☑ 银行数据流（蓝色虚线）
- ☑ 证券数据流（绿色虚线）
- ☑ Agent间数据流（黑色实线）

取消勾选后，对应的连接线隐藏，但节点保持显示。

### 搜索框
- 占位符文本："搜索角色、数据类型..."
- 实时搜索（输入时动态筛选）
- 显示搜索结果数量
- 匹配的节点用黄色边框高亮

### 图例按钮
点击后弹出悬浮窗，显示：
- 节点颜色说明（4种层级颜色）
- 连接线样式说明（3种数据源样式）
- 优先级标签说明（🔴核心 / 🟡重要 / 🟢可选）

---

## 九、关键数据示例

### 示例1：财富规划师 → 投资策略师

**连接线标签：** 标准化目标包

**详细数据内容：**
- 目标描述：学区房首付资金准备
- 目标金额：30万元
- 时间期限：12个月
- 风险承受度：中等
- 当前资产：10万元（银行存款）
- 月可投金额：2.5万元
- 流动性要求：高（12个月后必须可支取）
- 特殊约束：不能承受超过10%的本金损失

**用途说明：**
投资策略师基于这个目标包，结合市场环境，制定资产配置方案。因时间短且流动性要求高，配置偏保守：股票60%、债券30%、现金10%。

---

### 示例2：投资策略师 → 投资顾问

**连接线标签：** 配置需求

**详细数据内容：**
- 方案名称：方案2稳健型
- 资产配置比例：股票60% / 债券30% / 现金10%
- 产品要求：
  * 沪深300指数增强（30%）：费率<1.2%、规模5-50亿
  * 债券基金（30%）：中短债、信用评级AA+以上
  * 货币基金（10%）：7日年化>2%、规模>100亿
- 预期收益：6-8%年化
- 成功概率：85%
- 最大回撤：-12%

**用途说明：**
投资顾问基于这个配置需求，从1000+产品中筛选，精选5个产品推荐给用户。

---

### 示例3：银行数据源 → 数据分析师

**连接线标签：** 银行端完整数据

**详细数据内容：**
- 个人信息：王先生、35岁、已婚、产品经理、北京
- 收入：月工资3.5万、年终奖10万
- 支出：月支出2万（房贷1.2万+生活8000）
- 资产：活期10万、理财持仓15万
- 负债：房贷余额120万、月供1.2万
- 交易：近3个月购买2次理财

**用途说明：**
数据分析师整合这些数据，计算可投资金额（1.5万/月）、评估负债率（34%健康）、识别闲置资金（活期10万中4万可投资）。

---

## 十、响应式设计说明

**桌面端（>1280px）：**
- 主可视化区域占70%宽度
- 详情面板固定在右侧，宽度400px
- 显示完整的工具栏

**平板端（768px - 1280px）：**
- 主可视化区域占100%宽度
- 详情面板改为从右侧滑入的抽屉
- 工具栏可能需要折叠部分功能

**移动端（<768px）：**
- 主可视化区域占100%宽度
- 详情面板改为全屏弹窗
- 工具栏简化为下拉菜单
- 节点和文字适当放大

---

## 十一、开发优先级

**阶段1（核心功能 - 必须完成）：**
1. 实现基础的节点和连接线布局（按照参考图片风格）
2. 实现点击节点显示详情面板
3. 确保9个角色的完整数据都能正确显示

**阶段2（重要功能）：**
4. 实现场景切换功能（4个场景）
5. 实现数据源筛选功能
6. 优化交互动画和视觉效果

**阶段3（可选功能）：**
7. 实现搜索功能
8. 添加图例说明
9. 实现响应式设计

---

以上是开发这个数据流转可视化网页所需的完整上下文信息。关键要点是：准确展示9个角色的数据关系、清晰的分层布局、良好的交互体验、完整的数据展示。


# AI理财投顾平台 - 角色间数据流转图谱(精简版)

---

## 📊 **一、九个角色的输入输出关系**

### **【接口层】**

#### **🎯 调度协调管家 (Orchestrator)**

**输入来源：**
- **用户侧**：文字/语音输入、点击行为、页面停留时间、情绪语调等
- **各Agent侧**：所有8个专业Agent处理完成后的结果(对话内容、方案报告、风险预警、产品推荐、销售话术、资产概览、数据分析、市场研报)
- **数据分析师**：整合后的用户完整画像(包含银行和证券数据的综合分析结果)

**核心处理：**
通过NLU识别50+种场景意图,将复杂任务拆解为子任务,选择合适Agent进行串行/并行/递归调用,整合多Agent输出为自然对话,维护完整上下文确保对话连贯性

**输出目标：**
- **给用户**：整合后的统一自然语言回复
- **给Agent**：分派具体任务指令给对应专业Agent

**数据示例说明：**
输入包含用户文本、输入类型、会话ID和历史上下文;输出分为两类,面向用户的是对话内容和UI元素配置,面向Agent的是任务类型和上下文信息

---

### **【决策层】**

#### **💼 财富规划师 (Wealth Planner)**

**输入来源：**
- **调度协调管家**：需求挖掘/目标设定/危机应对任务指令
- **数据分析师**：用户画像(年龄/职业/收入/资产)、历史目标、行为特征、决策风格
- **财富管家**：投资表现数据、财务危机信号(节点19、21特定场景)
- **银行端、证券端**(通过数据分析师)：
  - 个人基础信息(姓名/年龄/性别/婚姻/职业/学历/城市) - 判断人生阶段
  - 收入数据(工资流水/奖金/月收入/收入稳定性) - 计算可投金额
  - 支出数据(日常消费/房贷车贷/信用卡还款/大额支出) - 评估现金流
  - 存款数据(活期/定期余额/到期日/利率) - 识别闲置资金
  - 负债数据(房贷/车贷/消费贷/信用卡负债) - 评估债务压力和投资能力
  - 理财产品持仓(产品名称/金额/净值/收益率) - 了解已有配置
  - 大额交易记录(转入转出/金额/时间) - 识别生命事件

  - 股票持仓(代码/数量/成本/市值/盈亏) - 识别真实风险偏好
  - 基金持仓(代码/份额/成本/市值/收益率) - 了解权益资产占比
  - 证券账户现金余额 - 计算总资产规模
  - 融资融券信息 - 识别杠杆使用情况
  - 交易记录 - 了解投资风格和经验水平

**核心处理：**
设计3-5轮开放式提问挖掘真实需求,识别缺失信息定向追问,将模糊目标转化为SMART目标,评估目标可行性,协调多目标优先级和资金分配,生成财富健康7维度评分诊断报告

**输出目标：**
- **投资策略师**：标准化目标包(目标描述、金额、期限、风险承受度、月投金额、流动性要求、约束条件、优先级等)
- **调度协调管家**：引导式提问内容、目标确认对话
- **数据分析师**：画像更新请求
- **客户理财顾问**：危机应对方案(节点21)

**关键场景流转：**
- 新用户目标设定时,从用户收集信息→结合数据分析师画像(含银行收支存款负债数据)→输出标准化目标包给投资策略师
- 目标达成复盘时,从财富管家获取表现数据→生成复盘报告→引导新目标
- 财务危机应对时,接收危机信号(如银行大额支出或收入骤降)→制定应急预案→协同客户理财顾问执行安抚

---

#### **📊 投资策略师 (Investment Strategist)**

**输入来源：**
- **财富规划师**：标准化目标包(金额/期限/风险/流动性要求)
- **市场研究员**：市场环境分析(牛熊震荡判断)、估值水平、宏观经济数据、行业投资价值
- **数据分析师**：用户当前持仓、风险承受能力评分、投资行为特征
- **财富管家**：持仓偏离度数据、再平衡触发信号(节点17)
- **银行端、证券端**(通过数据分析师)：
  - 总资产规模(存款+理财+其他资产) - 决定配置策略
  - 投资目标和期限 - 制定SAA/TAA策略
  - 风险测评结果(保守/稳健/进取) - 确定配置比例约束
  - 理财产品持仓 - 了解当前配置结构
  - 股票和基金持仓(代码/市值/占比) - 评估权益资产比例
  - 行业分布和集中度 - 识别风险敞口
  - 历史交易记录 - 了解操作习惯(定投/择时)
  - 持有周期 - 判断投资风格(长期/短期)

**核心处理：**
制定战略资产配置(SAA)确定长期比例,根据市场环境进行战术调整(TAA),生成保守/稳健/进取三种方案,运行10000次蒙特卡洛模拟计算达成概率,用历史10-20年数据回测验证,判断再平衡时机和幅度

**输出目标：**
- **投资顾问**：配置需求(资产配置比例、产品类型要求、筛选标准、预期收益、成功概率、最大回撤等)
- **风控合规官**：风险审核请求(三方案详细配置、压力测试数据)
- **调度协调管家**：方案展示数据(雷达图、模拟曲线、回测图表)
- **财富管家**：再平衡执行指令(节点17)
- **客户理财顾问**：市场危机应对策略(节点20)

**关键场景流转：**
- 首次方案设计时,接收目标包和市场数据→结合银行证券持仓数据→生成三方案→提交风控审核→配置需求传给投资顾问
- 策略动态调整时,接收再平衡信号→结合最新市场和证券持仓偏离度→生成调整方案→经风控审核后由财富管家执行
- 市场危机时,接收危机预警→分析市场数据→制定坚持/调整/暂停三种策略→给客户理财顾问执行沟通

---

#### **🛡️ 风控合规官 (Risk & Compliance Officer)**

**输入来源：**
- **投资策略师**：风险审核请求(三方案配置、模拟结果、用户信息)
- **数据分析师**：用户风险承受能力评分、风险测评结果、年龄投资经验、历史风险行为
- **市场研究员**：当前市场风险等级、系统性风险信号、产品风险评级
- **投资顾问**：待审核产品列表及风险指标(节点8、12)
- **外部市场**：实时行情数据(节点20)
- **银行端、证券端**(通过数据分析师)：
  - 风险测评结果(问卷答案/风险等级R1-R5/测评日期) - 适当性管理基础
  - 理财产品持仓(产品/金额/风险等级) - 计算风险敞口和集中度
  - 理财底层资产(投资方向/股债比例) - 穿透式风险评估
  - 负债数据(房贷/车贷/消费贷) - 评估负债率影响风险承受力
  - 产品流动性(赎回规则/封闭期/到账时间) - 评估流动性风险
  - 股票持仓(代码/市值/盈亏) - 计算市场风险和最大回撤
  - 行业和个股集中度 - 识别集中度风险
  - 融资融券信息(余额/倍数/与强平线距离) - 评估杠杆风险
  - 期权/衍生品持仓 - 识别超高风险操作
  - 历史交易记录 - 识别追涨杀跌行为模式
  - 股票/基金波动率、最大回撤、夏普比率 - 风险量化评估

**核心处理：**
计算产品风险与用户承受能力的适当性匹配度,进行2008/2015/2020三种极端情景压力测试,检查流动性是否满足目标期限,执行合规性检查(双录等),监控黄/橙/红三级预警阈值,决策是否需要强制干预熔断

**输出目标：**
- **投资顾问**：风险审核结果(各方案通过状态、匹配评分、风险提示文案、合规要求)
- **客户理财顾问**：风险揭示话术(最坏情况描述、历史极端数据、需确认风险点)
- **调度协调管家**：风险预警消息(节点20,预警级别、触发原因、影响用户、建议行动)
- **财富管家**：强制干预指令(节点20极端情况,强制止损无需用户确认)
- **数据分析师**：合规记录存档请求

**关键场景流转：**
- 方案风险审核时,接收三方案→结合银行风险测评和理财持仓、证券股票持仓和杠杆数据→计算适当性匹配度→输出审核结果
- 首次成交合规时,执行双录和风险测评→智能校验余额和风险匹配(银行理财+证券持仓总风险)→允许或禁止交易
- 市场危机预警时,检测大盘跌幅超阈值→评估用户证券持仓风险敞口→发布红色预警→启动多Agent协同应对
- 强制熔断时,检测持仓回撤超限(证券融资接近强平线)→发出强制止损指令→财富管家立即执行

---

### **【执行层】**

#### **📈 投资顾问 (Investment Advisor)**

**输入来源：**
- **投资策略师**：配置需求(产品类型、配置比例、筛选标准如费率规模等、预期收益约束)
- **风控合规官**：风险审核结果(哪些方案通过、需额外风险揭示内容、合规要求)
- **市场研究员**：产品评级数据库、基金经理履历库、产品研报、产品异常信号
- **数据分析师**：用户已有持仓、历史购买偏好、申购赎回记录
- **用户**：查看产品详情、确认购买操作(节点2、12)
- **银行端、证券端**(通过数据分析师)：
  - 可投资金额(活期余额-应急储备) - 产品筛选第一道门槛
  - 投资期限要求 - 匹配产品封闭期/流动性
  - 理财产品持仓(产品名称/类型/金额) - 避免重复配置
  - 银行客户等级(VIP/私行/普通) - 差异化服务和费率优惠
  - 购买记录(时间/产品类型/金额) - 识别购买偏好
  - 赎回历史(时间/金额/持有期限) - 了解投资风格
  - 产品费用明细(申购/赎回/管理/托管费) - 费率优化分析
  - 基金持仓明细(十大重仓股/行业分布/持仓占比) - 穿透式分析避免伪分散
  - 基金经理信息(名字/任期/历史收益/变动) - 评估管理稳定性
  - 基金规模变化(规模/趋势/异常增长) - 识别运作风险
  - 基金同类排名(排名/相对收益/跑输跑赢幅度) - 相对业绩评估
  - 交易记录和交易成本(佣金/交易费用) - 费率对标优化
  - 历史收益率 - 诊断持仓业绩表现

**核心处理：**
从1000+产品海选符合条件的50个,通过七维度评分初选15个,深度研究(底层持仓/经理风格/费率细节)精选5个,生成横向对比表,执行利他检查确保符合"三不推、三必须"原则,执行实际申购赎回交易

**输出目标：**
- **客户理财顾问**：产品推荐报告(5个精选产品详细信息、对比表、不推荐理由、最坏情况分析)
- **调度协调管家**：产品展示UI数据(产品卡片、对比表格、图表可视化)
- **财富管家**：交易执行结果(节点12,交易ID、购买产品份额、定投设置)
- **数据分析师**：交易记录(更新用户持仓)
- **用户**：案例展示内容、问答墙(节点2)

**关键场景流转：**
- 产品筛选推荐时,接收配置需求→基于银行可投金额和证券持仓明细筛选→从产品库海选初选精选→生成推荐报告→传给客户理财顾问
- 交易执行时,用户确认购买→经风控合规校验(银行余额充足+风险匹配)→执行交易→结果发给财富管家设置提醒和数据分析师更新持仓
- 产品异常监控时,市场研究员发现经理变更→评估影响→通知财富管家→预警提醒用户
- 持仓诊断时,穿透分析证券基金持仓明细→发现5只基金都重仓同一股票的伪分散问题→建议替换2-3只

---

#### **🧠 客户理财顾问 (Client Advisor)**

**输入来源：**
- **投资顾问**：产品推荐报告(5个精选产品、对比表、利他信息如不推荐理由和最坏情况)
- **数据分析师**：用户行为数据(页面停留时间识别犹豫、鼠标轨迹、查看频率识别焦虑)、情绪状态(焦虑/后悔/恐慌等及置信度)、认知偏差(损失厌恶/锚定效应等)、历史疑虑记录
- **风控合规官**：风险揭示文案(需说明的风险点、最坏情况、需确认内容)
- **投资策略师**：市场危机应对策略(节点20,坚持/调整/暂停三种及利弊)
- **市场研究员**：市场危机分析(节点20,原因、历史对比、恢复时间)
- **财富管家**：持仓数据(节点15,浮盈浮亏、查看频率异常)
- **银行端、证券端**(通过数据分析师)：
  - 购买记录(时间/产品/金额) - 识别决策偏好和风险倾向
  - 购买犹豫时长(产品页面停留/决策周期) - 判断决策风格
  - 市场波动时的行为(查看频率/操作) - 识别情绪模式
  - 对话历史和咨询记录 - 识别重复疑虑和关注点
  - 交易频率(月度交易次数) - 识别冲动交易
  - 追涨杀跌记录(高点买入/低点卖出) - 识别认知偏差
  - 持有时长(平均持有天数/最长最短周期) - 判断长期思维和耐心度
  - 交易时机选择 - 分析决策模式

**核心处理：**
基于用户画像和行为智能预判6个最可能的疑虑,设计坦诚建立信任的利他话术,识别12种投资认知偏差温和干预,识别6种情绪状态生成对应安抚话术,判断购买时机(准备好/犹豫/冲动),设计成交策略(阶梯式入场/7天冷静期等)

**输出目标：**
- **调度协调管家**：销售对话脚本(包括预判疑虑及回应、主动披露佣金、产品缺陷、不适合情况、建立信任元素)
- **调度协调管家**：临门成交话术(节点11,识别犹豫类型、干预策略如阶梯式入场、数据支撑、冷静期)
- **调度协调管家**：72小时陪伴话术(节点15,T+6h/24h/48h三次触达内容、异常行为干预)
- **调度协调管家**：危机安抚话术(节点20,情绪共情、三个数据支撑、三种选择、冷静期)
- **数据分析师**：用户情绪状态反馈(对话后情绪变化、干预是否有效)

**关键场景流转：**
- 疑虑解答时,接收产品报告→结合银行购买历史和证券交易记录识别偏好→智能预判6个疑虑→生成利他话术→展示给用户
- 临门犹豫干预时,检测到停留3分钟信号→结合行为数据和证券交易频率识别犹豫类型→生成阶梯式方案→引导成交
- 72小时陪伴时,T+6h新手教育→T+24h检测异常查看频率(银行APP+证券APP)→干预降低焦虑→T+48h鼓励坚持
- 市场危机安抚时,接收红色预警→汇总危机分析、证券持仓亏损数据→识别用户情绪(基于历史追涨杀跌记录)→生成个性化安抚话术→批量推送
- 认知偏差干预时,通过证券交易记录识别追涨杀跌/频繁交易/损失厌恶等偏差→设计温和干预话术→引导理性决策

---

#### **🏦 财富管家 (Wealth Manager)**

**输入来源：**
- **数据分析师**：用户持仓数据(实时持仓成本市值)、收益数据(浮盈浮亏历史收益率)、账户余额(闲置资金停留时间)、行为数据(查看交易频率)、目标数据(金额完成进度)
- **投资策略师**：再平衡指令(节点17,偏离原因、调整方案、预期影响)
- **市场研究员**：产品评级变化、产品异常事件(经理变更/规模异动/踩雷)、持仓匹配行业分析
- **投资顾问**：交易执行结果(节点12,购买产品金额份额、定投设置)
- **风控合规官**：强制干预指令(节点20极端情况,强制止损需立即执行)
- **银行端、证券端**(通过数据分析师)：
  - 理财产品持仓(名称/份额/净值/市值/成本) - 持仓体检基础
  - 理财产品净值历史 - 计算收益率、最大回撤等指标
  - 产品费用明细(申购/赎回/管理/托管费) - 费率优化分析
  - 分红记录(金额/时间/分红率) - 完整收益计算
  - 活期和定期存款余额 - 识别闲置资金
  - 定期存款到期日 - 规划再配置时机
  - 基金持仓明细(十大重仓股/行业分布/持仓占比) - 穿透式健康诊断
  - 基金经理信息(名字/任期/变动记录) - 评估管理质量风险
  - 基金规模变化(规模/趋势/异常) - 识别运作风险
  - 基金同类排名(排名/相对收益) - 相对业绩评估和替换决策
  - 股票和基金总市值 - 计算总资产和配置偏离度
  - 配股/权益事件 - 持仓变化追踪
  - 交易成本(佣金/年度总成本) - 成本优化

**核心处理：**
每日扫描闲置资金(余额>5000元且>7天)、监控持仓产品异常、检查再平衡阈值(偏离>15%)、检测行为异常(查看>15次/24h);每周评估持仓健康度七维度0-100分、生成智能提醒;每月生成月度报告6大板块、扫描费率优化机会;每季度评估再平衡和产品替换

**输出目标：**
- **调度协调管家**：智能提醒消息(定投日、目标进度、异常预警等)
- **调度协调管家**：月度财富健康报告(业绩表现、目标进度、7维度健康评分、行为评价、下月建议)
- **调度协调管家**：老客户快速服务界面(节点2.1,资产概览、智能提醒、快捷操作)
- **投资策略师**：再平衡触发信号(节点17,当前配置、目标配置、偏离度、建议行动)
- **客户理财顾问**：异常行为信号(节点15、20,频繁查看等、情绪预测、是否需干预)
- **财富规划师**：投资表现数据(节点19)、财务危机信号(节点21)
- **数据分析师**：持仓变更记录(再平衡结果、费率优化操作)

**关键场景流转：**
- 老客户快速服务时,用户刷卡→获取银行和证券完整持仓数据→生成资产概览(银行理财+证券股票基金总市值)和智能提醒→展示快捷操作界面
- 月度报告生成时,汇总银行理财持仓和证券基金股票收益→计算七维度评分(收益/风险/配置/产品质量/费率/流动性/目标匹配)→生成行为评价和下月建议→推送用户
- 再平衡流程时,检测证券持仓偏离16%(股票76% vs 目标60%)→触发信号给投资策略师→接收调整方案→经风控审核→执行调仓(卖出证券股票基金/买入银行债券产品)→通知用户
- 持仓体检时,穿透分析证券基金持仓明细→发现5只基金重仓同行业的伪分散→基金经理3人离职→费率对比发现银行理财费率高于证券ETF→生成优化方案(替换基金+切换低费率产品)
- 闲置资金识别时,扫描银行活期50万→计算应急储备需求20万→识别闲置30万→建议转入货币基金或证券账户投资
- 异常监控时,检测用户24h内查看银行APP 8次+证券APP 7次共15次→发出异常信号→客户理财顾问干预→降低用户焦虑

---

### **【支持层】**

#### **📊 数据分析师 (Data Analyst)**

**输入来源：**
- **调度协调管家**：用户对话内容(每轮完整记录,用于更新画像和记忆)
- **投资顾问**：交易记录(申购赎回产品金额时间,更新持仓)
- **财富管家**：持仓变更记录(再平衡结果、费率优化操作)
- **系统自动采集**：用户行为日志(登录时间频率、页面浏览路径停留、点击鼠标轨迹、查看账户频次、表单填写)
- **风控合规官**：风险测评结果(答案、评分、双录元数据)
- **财富规划师**：目标设定数据(用户目标、调整记录)
- **银行端、证券端**(核心数据整合源)：
  - **个人基础信息**：姓名/年龄/性别/婚姻/职业/学历/城市 - 构建用户基础画像
  - **收支数据**：工资流水/奖金/月收入/月支出/消费明细 - 评估财务健康和可投资能力
  - **资产数据**：活期/定期存款/理财产品持仓/保险产品 - 完整资产结构
  - **负债数据**：房贷/车贷/消费贷/信用卡负债 - 债务压力评估
  - **交易数据**：大额转账/购买赎回记录/产品持有周期 - 识别生命事件和投资偏好
  - **风险测评**：问卷答案/风险等级/测评日期 - 风险画像基础
  - **客户等级**：VIP等级/金融资产规模 - 差异化服务依据
  - **账户信息**：证券账户号/开户日期/账户类型/可用资金 - 完整资产视图
  - **股票持仓**：代码/数量/成本/市值/盈亏/行业分布 - 真实风险偏好识别
  - **基金持仓**：代码/份额/成本/市值/收益率/持仓明细 - 权益资产评估
  - **交易记录**：交易时间/品种/买卖方向/价格/费用 - 行为模式分析
  - **融资融券**：融资余额/倍数/与强平线距离 - 杠杆风险评估
  - **衍生品**：期权持仓/做空头寸 - 超高风险识别
  - **行为数据**：交易频率/追涨杀跌记录/持有时长 - 认知偏差识别

**核心处理：**
实时分析对话提取关键信息(年龄职业收入家庭),更新120+标签画像,识别行为特征(决策风格情绪偏差),异常检测(查看频率风险偏好突变);每日计算持仓数据(市值浮盈收益率)、目标进度(完成金额百分比预计时间)、流失风险预测;每周/月洞察用户行为模式、产品转化率分析、A/B测试效果评估;**最重要的是将银行和证券的原始数据整合为统一用户画像,构建完整资产全景图**

**输出目标：**
- **所有Agent**：用户画像数据(响应<1秒,包含基本信息、财务状况含银行存款负债+证券持仓、风险画像含测评结果+实际行为、投资目标、行为特征、120+标签)
- **所有Agent**：持仓数据(总资产=银行余额+理财市值+证券股票基金市值、总成本、总利润、总收益率、各持仓明细含银行理财和证券基金股票、当前配置、目标配置、偏离度)
- **所有Agent**：行为异常信号(类型如频繁查看、频率含银行APP+证券APP、阈值、检测时间、情绪预测)
- **所有Agent**：用户情绪状态(当前情绪、置信度、判断依据含银行购买犹豫+证券追涨杀跌、认知偏差)
- **所有Agent**：流失风险预测(30天90天流失概率、风险因素、预防行动)
- **调度协调管家**：每周产品转化率分析、每月用户行为洞察(分段特征、关键发现)
- **自己**：画像更新记录(审计和回溯)

**数据整合的核心价值：**
- **完整资产视图**：总资产=银行存款+银行理财+证券现金+证券股票基金市值,避免只看一端导致的判断偏差
- **真实风险识别**：对比银行风险测评(问卷显示保守)与证券实际操作(高频交易+高杠杆),发现风险测评失效问题
- **行为模式综合**：银行端购买犹豫+证券端追涨杀跌,综合识别用户的认知偏差和情绪特征
- **配置结构穿透**：银行理财底层资产+证券基金持仓明细,发现看似分散实际集中的伪分散问题
- **财务健康全貌**：银行负债率+证券杠杆率,全面评估用户真实债务压力和风险承受能力

**关键场景流转：**
- 画像构建时,用户回答结构化问题→提取信息→同时获取银行收支存款负债和证券持仓交易数据→整合为五维完整画像→存储
- 实时数据请求时,任意Agent发起请求→<1秒返回所需数据(如收入+证券持仓,综合计算可投金额)
- 行为异常检测时,采集银行APP和证券APP行为日志→检测频繁查看15次/24h→发出异常信号→财富管家→客户理财顾问干预
- 交易后更新时,投资顾问执行交易→传递交易记录→更新银行理财持仓或证券基金持仓→更新总资产和配置结构→更新"首次投资"标签
- 对话中更新时,用户提到收入变化或购房→实时更新银行端收入或负债数据→通知财富规划师可能需调整目标
- 风险偏好验证时,比对银行风险测评结果(R2保守)与证券实际持仓(200万股票+2倍杠杆)→发现不匹配→标记"风险测评失效"→通知风控官重新评估

---

#### **🔍 市场研究员 (Market Researcher)**

**输入来源：**
- **外部信息源**：13大来源自动采集(财经新闻、券商研报、监管公告、政策文件、宏观数据如GDP/CPI/PMI、行业动态、社交媒体情绪、基金公告、产品评级、持仓数据、业绩数据、估值数据、技术指标)
- **投资策略师**：研究需求(如行业投资价值分析,24小时内完成)
- **投资顾问**：产品研究需求(如基金经理变更影响分析)

**注**：市场研究员主要关注宏观市场和产品层面的数据,不需要个人用户的银行和证券数据,其研究成果为其他Agent提供市场环境和产品分析支持

**核心处理：**
7×24小时实时采集13大信息源,信息过滤去重去噪,按关键词和来源权威性排序,识别系统性/行业/个股风险信号,触发阈值立即预警;每日凌晨扫描隔夜市场生成200字精简简报;每周轮动深度研究13个行业;每月推送10个投资机会更新产品评级库;突发事件1小时内分析影响给出应对建议

**输出目标：**
- **投资策略师**：每日市场简报(主动推送,隔夜市场、今日预测、关键事件、机会风险)
- **投资策略师**：市场环境分析(被动响应,市场阶段、估值水平、宏观环境、风险级别)
- **投资顾问**：产品评级数据库(主动推送异常如经理变更、影响分析、持有建议)
- **投资顾问**：产品深度研报(被动响应,经理档案、业绩分析、持仓分析、费率结构)
- **风控合规官**：风险信号预警(主动推送,预警级别、风险类型、影响范围、建议行动)
- **财富管家**：持仓匹配行业分析(主动推送,用户持仓对应行业、行业更新、对组合影响)
- **客户理财顾问**：危机分析报告(节点20,触发事件、原因分析、历史对比、平均恢复时间、未来展望)

**关键场景流转：**
- 每日晨报时,凌晨采集外部信息→生成简报→早8点前推送投资策略师→决策当日策略
- 深度研究时,投资策略师请求分析半导体→24小时内深度研究→输出行业报告
- 产品异常预警时,发现基金公告经理变更→影响分析→通知投资顾问和财富管家→向持仓用户推送说明
- 风险预警触发时,外部市场大盘跌-6.2%→识别系统性风险→通知风控合规官→发布红色预警→启动应对链路
- 市场危机分析时,接收红色预警→30分钟内输出危机分析→传给投资策略师制定策略和客户理财顾问安抚用户
- 持仓匹配推送时,接收用户持仓(来自数据分析师的银行理财+证券基金股票)→匹配相关行业→有重大更新主动推送→财富管家呈现在月报中

---

## 🔄 **二、完整数据流转场景**

### **场景1：新用户首次购买完整链路**

**第1步-接待识别(节点1)**：用户靠近VTM→调度协调管家检测→请求数据分析师判断身份(查询银行和证券账户记录)→返回"新用户"标识→路由到投资顾问展示案例

**第2步-需求挖掘(节点5-7)**：用户表达"想给孩子存教育金"→调度协调管家识别意图路由财富规划师→请求用户画像(数据分析师从银行获取收入3.5万/月支出2万/存款10万/房贷月供1.2万,从证券获取股票持仓0/基金持仓0)→开始3-5轮引导对话(孩子年龄6岁、学区房需求、首付缺口30万、时间期限12个月)→基于银行收支数据计算月可投2.5万→输出标准化目标包(学区房首付30万、12个月、中等风险、月投2.5万、高流动性要求)→传递给投资策略师

**第3步-方案设计(节点8)**：投资策略师接收目标包→请求市场数据(震荡市、估值中等偏低)→结合用户银行总资产(存款10万+理财0)和证券持仓(0元,新手)→SAA计算+蒙特卡洛10000次模拟→生成三方案(保守/稳健/进取)→提交风控审核→风控请求用户风险数据(银行风险测评60分中等,证券持仓0无历史参考,负债率34%合理)→适当性匹配计算→方案2匹配度85%通过→传递投资顾问→请求产品库数据→基于银行可投金额2.5万/月筛选符合门槛产品→海选50个初选15个精选5个→生成产品推荐报告(易方达300等精选产品、对比表、不推荐理由、最坏情况-12%回撤)→传递客户理财顾问

**第4步-疑虑解答(节点9)**：客户理财顾问接收产品报告→请求用户画像(银行无购买历史/证券无交易记录=新手)和历史疑虑(对话中3次提到"会否亏本金")→请求风险揭示文案→智能预判6个疑虑(会否亏本金、费用多少、能否坚持等,针对新手加强本金保护说明)→生成利他话术(坦诚告知短期可能浮亏、透明披露佣金、说明产品缺陷、明确不适合情况)→调度协调管家整合展示给用户

**第5步-临门犹豫(节点11)**：用户看完方案停留3分15秒未点击→调度协调管家检测犹豫信号→通知客户理财顾问→请求行为数据(停留时间、鼠标徘徊、情绪=焦虑,新手特征明显)→识别犹豫类型"担心坚持不下来"→生成阶梯式入场方案(第一月30%试水、逐月加到100%、随时可停)→用户接受点击确认

**第6步-合规成交(节点12)**：风控合规官执行风险测评10题→双录视频AI提问6个问题→智能校验(银行活期余额10万充足✓、风险匹配中等✓、证券账户未开通建议同步开通以便将来配置)→放行交易→投资顾问执行交易(银行端购买易方达300等理财产品)→输出交易结果(购买易方达300等、设置每月1号定投2.5万)→分发结果→财富管家设置智能提醒(定投日、目标进度)→数据分析师更新持仓数据(银行理财持仓新增)和"首次投资"标签

**第7步-72小时陪伴(节点15)**：T+6h客户理财顾问第一次触达(打预防针:未来12个月可能3-5次浮亏)→T+24h数据分析师检测查看银行APP 15次/24h异常(新手焦虑特征)→财富管家接收信号转发→客户理财顾问生成干预话术(建议降低查看频率,新手建议每周1次)→T+48h第三次触达鼓励坚持→T+72h交接财富管家进入日常服务

---

### **场景2：老客户快速服务**

用户刷卡/人脸识别→调度协调管家识别身份→请求数据分析师确认(老客户,银行有理财持仓15万、证券有基金持仓17.8万)→路由财富管家(跳过需求挖掘)→请求持仓数据(银行理财15万+证券基金17.8万=总资产32.8万、本月+2.3%、目标进度38%)→生成资产概览界面(欢迎回来、资产变动含银行和证券分项、智能提醒如明天定投日/建议将银行理财切换为证券ETF省180元、快捷操作)→显示给用户→用户点击"追加定投"→路由投资顾问→验证银行账户余额充足→执行交易(银行端追加定投)→返回确认(追加1万、下次扣款6月1日)→显示确认页→总耗时2分钟完成

---

### **场景3：市场危机应对**

外部市场大盘暴跌-6.2%→风控合规官实时监控触发→评估所有用户证券持仓风险敞口(筛选出证券持仓>50万且股票占比>60%的高风险用户)→5分钟内发布红色预警(预警级别red、触发原因、影响用户列表、时间戳)→同时触发4个Agent并行工作：市场研究员30分钟输出危机分析报告(原因、历史对比恢复时间)、投资策略师生成三种应对策略(坚持评分5/暂停评分2/赎回评分1)、财富管家识别需安抚用户列表(从数据分析师获取证券持仓亏损数据)、数据分析师提供所有持仓用户数据(银行理财+证券持仓完整数据,证券股票基金今日亏损金额)→所有数据汇总到客户理财顾问→生成个性化安抚话术(按情绪分类,针对证券持仓100万亏损-6.2万的恐慌用户:共情亏损感受+三个数据支撑历史规律30天恢复/定投优势下月多赚/坚持93%盈利+三种选择+24h冷静期;针对银行理财为主证券持仓少的稳健用户:简要说明影响有限无需担心)→调度协调管家批量推送给所有持仓用户

---

### **场景4：策略动态调整(再平衡)**

定期检查或持续监控→财富管家请求持仓数据→数据分析师返回(银行理财10万占总资产30.5%+证券股票基金22.8万占69.5%,其中股票型基金占总资产76%,目标60%)→检测偏离+16%超过15%阈值→发出再平衡触发信号(包含当前配置、目标配置、偏离度)→投资策略师接收→请求市场数据(当前环境、估值水平)→评估需要调整→生成再平衡方案(减少证券股票基金52480元从76%降至60%、增加银行债券理财或证券债券基金32800元从20%升至30%、预计降低波动3%)→提交风控审核→审核通过(调整后风险降低符合承受能力)→财富管家接收执行指令→执行交易(证券端卖出部分股票基金3万、银行端或证券端买入债券产品3.28万)→输出执行结果(新配置股票60%债券30%现金10%,资金分布银行11.28万+证券19.8万)→分发结果→数据分析师更新持仓(银行和证券持仓明细)→投资策略师记录历史→调度协调管家通知用户(组合已再平衡、降低波动3%)

---

## 📋 **三、核心数据结构总结**

### **1. 标准化目标包(财富规划师→投资策略师)**
包含目标ID、目标描述、目标金额、时间期限(月)、风险承受度(低/中/高)、当前资产(银行存款+理财+证券持仓)、月投金额(基于银行收支数据计算)、流动性要求、特殊约束条件、优先级(P1/P2/P3)、用户ID、创建时间等核心字段

### **2. 配置需求(投资策略师→投资顾问)**
包含方案ID、用户ID、资产配置比例(股债现)、产品要求(各类产品的配置占比和筛选标准如费率上限/规模范围/跟踪误差/最低年限等)、月投金额、业绩预期(预期收益区间/成功概率/最大回撤)、当前持仓(银行理财+证券基金股票)、创建时间等

### **3. 产品推荐报告(投资顾问→客户理财顾问)**
包含报告ID、方案ID、用户ID、各类产品的首选推荐(产品名称代码、渠道标注银行端或证券端、基金公司、经理信息含经验风格、业绩分析含年化收益超额收益最大回撤夏普比率、费率结构、规模、推荐理由)、备选产品及关键差异、横向对比表(同类产品在银行和证券的费率对比)、不推荐理由、最坏情况(历史事件/最大回撤/示例损失/恢复时间/最终价值)、创建时间等

### **4. 用户画像(数据分析师→所有Agent)**
包含用户ID、更新时间、基本信息(姓名年龄性别地区职业家庭结构子女)、财务状况(月收入稳定性来源/月支出明细/资产含银行现金定期理财+证券现金股票基金总市值/负债含银行房贷车贷+证券融资余额/应急储备月数/财富健康评分)、风险画像(承受能力评分0-100含银行风险测评结果/风险等级/实际行为风格含证券交易记录/损失容忍度/判断依据含问卷+实际操作对比)、投资目标(主要目标和次要目标含描述金额期限优先级进度)、行为特征(投资经验年数/知识水平/查看频率含银行APP+证券APP/坚持率/追涨杀跌次数含证券交易记录/决策风格/情绪稳定性/认知偏差/学习意愿)、120+个标签等

### **5. 月度财富健康报告(财富管家→用户)**
包含报告ID、用户ID、报告月份、生成时间、业绩表现(总资产=银行存款+理财市值+证券现金+股票基金市值、总成本、总利润/月度年初至今年化收益率含银行理财收益+证券投资收益/与基准对比)、目标进度(目标金额已完成金额完成百分比剩余天数状态领先落后程度预计最终金额)、健康评分(总分及七维度评分含收益表现/风险水平含银行理财风险+证券持仓风险/配置健康含银行证券资金分布合理性/产品质量含银行理财评级+证券基金评级/成本费率含银行费用+证券费用对比/流动性含银行定期+证券持仓流动性/目标匹配,每维度含分数状态详细说明)、行为评价(坚持性含总期数完成期数坚持率评级评语/查看频率含银行APP+证券APP每周次数评级评语/追涨杀跌含证券交易记录次数评级评语)、市场解读(市场总结/组合表现含银行和证券产品分别表现/下月展望)、下月建议(各建议含类型优先级图标标题内容可操作性及行动链接,如建议将银行理财切换为证券ETF节省费率)等


